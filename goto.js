var map;var map = {    map     : null,    markers : [],    init : function() {        this.getLocation();    },    initMap : function(currentPos) {        map.map = new google.maps.Map(document.getElementById('map'), {            center : currentPos,            zoom   : 12,            styles : [{"featureType":"all","elementType":"all","stylers":[{"color":"#ffffff"}]},{"featureType":"all","elementType":"geometry.fill","stylers":[{"color":"#e5e3df"}]},{"featureType":"all","elementType":"labels","stylers":[{"visibility":"off"}]},{"featureType":"all","elementType":"labels.text.fill","stylers":[{"gamma":0.01},{"lightness":20}]},{"featureType":"all","elementType":"labels.text.stroke","stylers":[{"saturation":-31},{"lightness":-33},{"weight":2},{"gamma":0.8}]},{"featureType":"all","elementType":"labels.icon","stylers":[{"visibility":"off"}]},{"featureType":"administrative","elementType":"geometry","stylers":[{"visibility":"simplified"}]},{"featureType":"administrative","elementType":"labels","stylers":[{"visibility":"off"}]},{"featureType":"landscape","elementType":"all","stylers":[{"color":"#c02222"},{"visibility":"off"}]},{"featureType":"landscape","elementType":"geometry","stylers":[{"lightness":30},{"saturation":30}]},{"featureType":"landscape","elementType":"geometry.fill","stylers":[{"color":"#e7e7e7"}]},{"featureType":"landscape","elementType":"labels","stylers":[{"visibility":"off"}]},{"featureType":"poi","elementType":"geometry","stylers":[{"saturation":20}]},{"featureType":"poi","elementType":"geometry.fill","stylers":[{"color":"#3f9a5c"}]},{"featureType":"poi","elementType":"geometry.stroke","stylers":[{"visibility":"on"},{"color":"#499d4f"}]},{"featureType":"poi","elementType":"labels","stylers":[{"visibility":"off"}]},{"featureType":"poi.attraction","elementType":"all","stylers":[{"visibility":"off"}]},{"featureType":"poi.business","elementType":"all","stylers":[{"visibility":"off"}]},{"featureType":"poi.government","elementType":"all","stylers":[{"visibility":"off"}]},{"featureType":"poi.medical","elementType":"all","stylers":[{"visibility":"off"}]},{"featureType":"poi.park","elementType":"geometry","stylers":[{"lightness":20},{"saturation":-20}]},{"featureType":"poi.park","elementType":"geometry.fill","stylers":[{"color":"#499d4f"}]},{"featureType":"poi.park","elementType":"labels","stylers":[{"visibility":"off"}]},{"featureType":"poi.place_of_worship","elementType":"all","stylers":[{"visibility":"off"}]},{"featureType":"poi.school","elementType":"all","stylers":[{"visibility":"off"}]},{"featureType":"poi.sports_complex","elementType":"all","stylers":[{"visibility":"off"}]},{"featureType":"road","elementType":"all","stylers":[{"visibility":"off"},{"color":"#c0c0c0"}]},{"featureType":"road","elementType":"geometry","stylers":[{"lightness":10},{"saturation":-30},{"visibility":"off"}]},{"featureType":"road","elementType":"geometry.fill","stylers":[{"color":"#e1e1e1"}]},{"featureType":"road","elementType":"geometry.stroke","stylers":[{"saturation":25},{"lightness":25}]},{"featureType":"road","elementType":"labels","stylers":[{"visibility":"off"}]},{"featureType":"transit","elementType":"all","stylers":[{"visibility":"off"}]},{"featureType":"transit","elementType":"labels","stylers":[{"visibility":"off"}]},{"featureType":"water","elementType":"all","stylers":[{"lightness":-20}]},{"featureType":"water","elementType":"geometry.fill","stylers":[{"color":"#5091b7"}]},{"featureType":"water","elementType":"labels","stylers":[{"visibility":"off"}]}]        });        var service = new google.maps.places.PlacesService(map.map);        service.nearbySearch({            location : currentPos,            radius   : 1000,            types    : ['restaurant']        }, map.setPlaces);        map.generateMarkers();    },    getLocation : function() {        navigator.geolocation.getCurrentPosition(function(position){            map.initMap({lat:position.coords.latitude, lng:position.coords.longitude});        });    },    addMarker : function(coords, label) {        var marker = new google.maps.Marker({            position : coords        });        var infoWindow = new google.maps.InfoWindow({            content : label        });        marker.addListener('click', function() {            infoWindow.open(map.map, marker);        })        return marker;    },    generateMarkers : function() {        map.markers = [];        localforage.getItem('graphiti', function(err, val) {            if(err) {                console.log('error local storage', err);            }            console.log(val);            val.forEach(function(graphiti) {                if (graphiti.coords && graphiti.coords.lat) {                    var marker = map.addMarker(graphiti.coords, graphiti.graphiti);                    map.markers.push(marker);                }            });            map.markers.forEach(function(marker) {                marker.setMap(map.map);            });        });    },    setPlaces : function(results, status) {        if (status === google.maps.places.PlacesServiceStatus.OK) {            var str = JSON.stringify(results);            var places = []            for (var i = 0; i < results.length; i++) {                places.push({lat:results[i].geometry.location.lat(), lng:results[i].geometry.location.lng()});            }            localforage.setItem('places', places, function(err, value){                if (err) {                    console.error(err);                }                else{                    map.createNav(places);                }            });        }    },    createNav : function(places) {        var place = places[getRandomInt(0, 19)];        var route = new ffwdme.routingService({            dest: place        }).fetch();    }};ffwdme.initialize({    routing: 'GraphHopper',    graphHopper: {        apiKey: 'c62916b3-35a1-4bac-bd03-ab564755ec0d'    }});ffwdme.on('routecalculation:success', function(response) {    ffwdme.navigation.setRoute(response.route).start();});ffwdme.on('navigation:onroute', function(e) {    var distance = e.navInfo.distanceToNextDirection;    if(distance < 10){        switch (e.navInfo.nextDirection.turn_type){            case 'TL':                window.navigator.vibrate(200);                break;            case 'TR':                window.navigator.vibrate(200,100,200);                break;        }    }});function getRandomInt(min, max) {    return Math.floor(Math.random() * (max - min)) + min;}